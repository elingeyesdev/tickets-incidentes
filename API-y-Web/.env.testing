# =============================================================================
# HELPDESK SYSTEM - TEST ENVIRONMENT CONFIGURATION
# =============================================================================
# This file overrides .env values when running tests (php artisan test)
# Bootstrap/app.php loads this file explicitly during test execution
# =============================================================================

# CRITICAL: Must match phpunit.xml settings
APP_ENV=testing
APP_DEBUG=false

# Database Configuration - ISOLATED TEST DATABASE
# Uses helpdesk_test instead of helpdesk (production)
DB_CONNECTION=testing
DB_HOST=postgres
DB_PORT=5432
DB_DATABASE=helpdesk_test
DB_USERNAME=helpdesk
DB_PASSWORD=helpdesk_password
# Multi-schema PostgreSQL configuration (same as production)
DB_SCHEMA_AUTH=auth
DB_SCHEMA_BUSINESS=business
DB_SCHEMA_TICKETING=ticketing
DB_SCHEMA_AUDIT=audit

# Redis Configuration - ISOLATED REDIS DATABASES
# Tests use DB 20-21, production uses DB 0-1
# Higher range avoids collisions with parallel workers (which use modulo calculation)
# This prevents Worker 6 (6 % 16 = 6, but could collide with DB 10 modulo math)
REDIS_CLIENT=phpredis
REDIS_HOST=redis
REDIS_PASSWORD=null
REDIS_PORT=6379
REDIS_DB=20
REDIS_CACHE_DB=21

# Cache Configuration - WITH TEST PREFIX
CACHE_STORE=redis
CACHE_PREFIX=helpdesk_test_cache

# Session Configuration - ARRAY DRIVER (in-memory, doesn't need Redis)
SESSION_DRIVER=array
SESSION_LIFETIME=120
SESSION_ENCRYPT=false
SESSION_PATH=/
SESSION_DOMAIN=null

# Queue Configuration - KEEPS REDIS (tests use Redis DB 10)
QUEUE_CONNECTION=redis
QUEUE_REDIS_CONNECTION=default

# Broadcasting (same as production)
BROADCAST_CONNECTION=log

# Filesystem (same as production)
FILESYSTEM_DISK=local

# Mail Configuration - USE MAILPIT (development docker service)
MAIL_MAILER=smtp
MAIL_HOST=mailpit
MAIL_PORT=1025
MAIL_USERNAME=null
MAIL_PASSWORD=null
MAIL_ENCRYPTION=null
MAIL_FROM_ADDRESS="noreply@helpdesk.test"
MAIL_FROM_NAME="Helpdesk Test"

# Application Settings
APP_NAME="Helpdesk System"
APP_KEY=base64:ft//QTYfR28foJzpr1BCdMGPcekiKWgOV6IKV8wOz7Y=
APP_URL=http://localhost:8000

APP_LOCALE=en
APP_FALLBACK_LOCALE=en
APP_FAKER_LOCALE=en_US

APP_MAINTENANCE_DRIVER=file
PHP_CLI_SERVER_WORKERS=4
BCRYPT_ROUNDS=4

# Logging - REDUCED NOISE FOR TESTS
LOG_CHANNEL=stack
LOG_STACK=single
LOG_DEPRECATIONS_CHANNEL=null
LOG_LEVEL=error

# AWS Configuration (same as production - not used in tests)
AWS_ACCESS_KEY_ID=
AWS_SECRET_ACCESS_KEY=
AWS_DEFAULT_REGION=us-east-1
AWS_BUCKET=
AWS_USE_PATH_STYLE_ENDPOINT=false

# Vite Configuration
VITE_APP_NAME="${APP_NAME}"
VITE_BACKEND_URL=http://localhost:8000

# GraphQL Configuration - DISABLE CACHE IN TESTS
LIGHTHOUSE_CACHE_ENABLE=false
LIGHTHOUSE_CACHE_VERSION=1
LIGHTHOUSE_SECURITY_DISABLE_INTROSPECTION=false

# JWT Authentication (same fixture as production)
JWT_SECRET=nosesifuncionaremos
JWT_TTL=60
JWT_REFRESH_TTL=20160

# OAuth Configuration (same as production - not used in tests)
GOOGLE_CLIENT_ID=
GOOGLE_CLIENT_SECRET=
GOOGLE_REDIRECT_URI="${APP_URL}/auth/google/callback"

# Development Tools (disabled for tests)
TELESCOPE_ENABLED=false
PULSE_ENABLED=false
NIGHTWATCH_ENABLED=false
