[www]
user = helpdesk
group = www-data
listen = 9000

; ========== OPTIMIZED FOR 16 CORES / 16GB RAM ==========
; Dynamic pool for development (auto-scales with load)
pm = dynamic
pm.max_children = 32                        ; Up to 32 concurrent PHP processes
pm.start_servers = 8                        ; Start with 8 processes
pm.min_spare_servers = 4                    ; Keep minimum 4 idle
pm.max_spare_servers = 16                   ; Maximum 16 idle processes
pm.max_requests = 1000                      ; Restart process after 1000 requests (memory leak prevention)

; Process management
pm.process_idle_timeout = 60s                ; Kill idle processes after 60s
pm.status_path = /php-fpm-status            ; Performance monitoring endpoint

; Memory and timeouts
pm.max_spawn_rate = 16                      ; Spawn max 16 processes per second

; Logging dentro del proyecto
access.log = /var/www/storage/logs/fpm-access.log
slowlog = /var/www/storage/logs/fpm-slow.log
request_slowlog_timeout = 5s

; Capturar output de PHP
catch_workers_output = yes

; Performance settings
request_terminate_timeout = 300             ; Kill requests after 5 minutes
pm.process_idle_timeout = 60s               ; Kill idle processes